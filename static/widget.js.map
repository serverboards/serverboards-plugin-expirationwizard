{"version":3,"file":null,"sources":["../src/timeline.js","../src/widget.js"],"sourcesContent":["const {React, moment} = Serverboards\n\nfunction TimelineLine({expiration, service, onClick}){\n  return (\n    <li key={`${expiration.service}/${expiration.name}/${expiration.date}/${expiration.id}`}\n      data-tooltip={`${expiration.description || \"\"}\\n${expiration.date}`}>\n      <a onClick={onClick}>\n      {service.name}\n      </a>\n      -- {expiration.name} -- {moment(expiration.date).fromNow()}\n    </li>\n  )\n}\n\nfunction Timeline({expirations, onShowService, getServiceByUUID}){\n  return (\n    <ul>\n      {expirations.map( (e) => (\n        <TimelineLine expiration={e} service={getServiceByUUID(e.service)} onClick={() => onShowService(e.service)}/>\n      ))}\n    </ul>\n  )\n}\n\nexport default Timeline\n","const {plugin, React, store, cache, Flash} = Serverboards\nconst plugin_id=\"serverboards.expiration\"\nimport Timeline from './timeline'\nconst {Loading} = Serverboards.Components\n\nconst Model = React.createClass({\n  getInitialState(){\n    const state = store.getState()\n    console.log(state)\n    return {\n      expirations: undefined,\n      serverboard: state.serverboard.serverboard,\n      service_by_uuid: undefined\n    }\n  },\n  componentDidMount(){\n    plugin.start_call_stop(\"serverboards.expiration/command\", \"list_expirations\", [])\n      .then( (expirations) => this.setState( {expirations} ) )\n    cache.services().then( (services) => {\n      let service_by_uuid={}\n      services.map( (s) => service_by_uuid[s.uuid]=s )\n      this.setState({service_by_uuid})\n    })\n  },\n  handleShowService(serviceid){\n    store.goto(`/serverboard/${this.state.serverboard.shortname}/services/${serviceid}`)\n  },\n  handleReload(){\n    Flash.info(\"This will take long time\")\n    plugin.start_call_stop(\"serverboards.expiration/command\", \"update_expirations\", [])\n      .then( () => { Flash.info(\"Expiration updated\"); this.componentDidMount() } )\n      .catch( (e) => Flash.error(e) )\n  },\n  getServiceByUUID(uuid){\n    return this.state.service_by_uuid[uuid]\n  },\n  render(){\n    if (!this.state.expirations || !this.state.service_by_uuid)\n      return (\n        <Loading>Expirations</Loading>\n      )\n    return (\n      <div>\n        <Timeline\n          expirations={this.state.expirations}\n          onShowService={this.handleShowService}\n          getServiceByUUID={this.getServiceByUUID}\n          />\n        <button className=\"ui button yellow with icon\" onClick={this.handleReload}>\n          <i className=\"ui refresh icon\"/>\n        </button>\n\n      </div>\n    )\n  }\n})\n\n\nfunction main(el, config){\n  Serverboards.ReactDOM.render(<Model {...config}/>, el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_widget(`${plugin_id}/widget`, main)\n"],"names":["Serverboards","React","moment","expiration","service","onClick","name","date","id","description","fromNow","expirations","onShowService","getServiceByUUID","map","e","plugin","store","cache","Flash","plugin_id","Components","Loading","Model","createClass","getInitialState","getState","log","state","serverboard","service_by_uuid","componentDidMount","start_call_stop","then","setState","services","s","uuid","handleShowService","serviceid","goto","shortname","handleReload","info","catch","error","render","el","config","ReactDOM","unmountComponentAtNode","add_widget","main"],"mappings":"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"}