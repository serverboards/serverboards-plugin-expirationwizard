{"version":3,"file":null,"sources":["../src/timeline.js","../src/widget.js"],"sourcesContent":["const {React, moment} = Serverboards\nconst {Calendar} = Serverboards.Components\n\nconst TimelineLine = React.createClass({\n  componentDidMount(){\n    $(this.refs.el).popup()\n  },\n  render(){\n    const {expiration, service, onClick, hasDivider, showCalendar} = this.props\n    const date = moment(expiration.date)\n    const expired = date.isBefore(moment())\n    let style = {paddingLeft: 5, paddingBottom: \"1rem\", cursor: \"pointer\"}\n    if (hasDivider){\n      style.borderTop=\"1px solid #eee\"\n      style.paddingTop=\"1rem\"\n    }\n    return (\n      <div className=\"row\" ref=\"el\"\n        key={`${expiration.service}/${expiration.name}/${expiration.date}/${expiration.id}`}\n        data-content={`${expiration.name}\\n${expiration.description || \"\"}`}\n        data-position=\"bottom center\"\n        data-date={date.format(\"YYYY-MM-DD\")}\n        style={style}\n        onClick={() => showCalendar(date.year(), date.month())}\n        >\n          <div>\n            <a onClick={(ev) => onClick() && ev.stopPropagation()}><b>{service.name}</b></a> - {date.fromNow()}\n          </div><div className={expired ? \"ui text red\" : \"\"}>\n            {expired ? \"Expired\" : \"Expires\" } on {date.format(\"MMM Do, YY\")}\n          </div>\n      </div>\n    )\n  }\n})\n\nconst Timeline = React.createClass({\n  getInitialState(){\n    let marks = {}\n    const now = moment()\n    marks[now.format(\"YYYY-MM-DD\")]=\"bold text teal\"\n\n    for (let exp of this.props.expirations){\n      marks[moment(exp.date).format(\"YYYY-MM-DD\")]=\"background light grey\"\n    }\n\n    return {\n      marks,\n    }\n  },\n  gotoDate(date){\n    date=date.format(\"YYYY-MM-DD\")\n    const vel = $(this.refs.list).find(`[data-date=\"${date}\"]:first`)\n    const parent=vel.parent()\n    const offset=vel.offset().top - parent.offset().top + parent.scrollTop()\n    parent.scrollTop( offset )\n  },\n  showCalendar(year, month){\n    this.setState({year, month})\n  },\n  render(){\n    const {expirations, onShowService, getServiceByUUID, maxHeight} = this.props\n    const state = this.state\n    return (\n      <div>\n        <Calendar marks={state.marks} navigation={true} onClick={this.gotoDate} month={this.state.month} year={this.state.year}/>\n        <div ref=\"list\" className=\"ui vertically divided list\" style={{overflow:\"auto\", maxHeight: maxHeight}}>\n          {expirations.map( (e, n) => (\n            <TimelineLine\n              key={`${e.service}/${e.check}`}\n              expiration={e}\n              service={getServiceByUUID(e.service)}\n              onClick={() => onShowService(e.service)}\n              hasDivider={n!=0}\n              showCalendar={this.showCalendar}\n              />\n          ))}\n        </div>\n      </div>\n    )\n  }\n})\n\nexport default Timeline\n","const {plugin, React, store, cache, Flash} = Serverboards\nconst plugin_id=\"serverboards.expiration\"\nimport Timeline from './timeline'\nconst {Loading} = Serverboards.Components\n\nconst Model = React.createClass({\n  getInitialState(){\n    const state = store.getState()\n    console.log(state)\n    return {\n      expirations: undefined,\n      serverboard: state.serverboard.serverboard,\n      service_by_uuid: undefined\n    }\n  },\n  componentDidMount(){\n    plugin.start_call_stop(\"serverboards.expiration/command\", \"list_expirations\", [])\n      .then( (expirations) => this.setState( {expirations} ) )\n      .catch( e => Flash.error(e) )\n    cache.services().then( (services) => {\n      let service_by_uuid={}\n      services.map( (s) => service_by_uuid[s.uuid]=s )\n      this.setState({service_by_uuid})\n    })\n  },\n  handleShowService(serviceid){\n    store.goto(`/serverboard/${this.state.serverboard.shortname}/services/${serviceid}`)\n  },\n  handleReload(){\n    Flash.info(\"This will take long time\")\n    plugin.start_call_stop(\"serverboards.expiration/command\", \"update_expirations\", [])\n      .then( () => { Flash.info(\"Expiration updated\"); this.componentDidMount() } )\n      .catch( (e) => Flash.error(e) )\n  },\n  getServiceByUUID(uuid){\n    return this.state.service_by_uuid[uuid]\n  },\n  render(){\n    if (!this.state.expirations || !this.state.service_by_uuid)\n      return (\n        <Loading>Expirations</Loading>\n      )\n    return (\n      <div className={`ui expirations ${this.props.layout}`}>\n        <Timeline\n          expirations={this.state.expirations}\n          onShowService={this.handleShowService}\n          getServiceByUUID={this.getServiceByUUID}\n          />\n        <button className=\"ui button yellow with icon\" onClick={this.handleReload}>\n          <i className=\"ui refresh icon\"/>\n        </button>\n\n      </div>\n    )\n  }\n})\n\n\nfunction main(el, config, extra){\n  let layout\n  if (extra.layout.width==1 && extra.layout.height==2)\n    layout=\"small\"\n  else if (extra.layout.width > extra.layout.height)\n    layout=\"horizontal\"\n  else\n    layout=\"vertical\"\n\n  Serverboards.ReactDOM.render(<Model {...config} layout={layout}/>, el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_widget(`${plugin_id}/widget`, main)\n"],"names":["Serverboards","React","moment","Calendar","Components","TimelineLine","createClass","componentDidMount","$","refs","el","popup","render","props","expiration","service","onClick","hasDivider","showCalendar","date","expired","isBefore","style","paddingLeft","paddingBottom","cursor","borderTop","paddingTop","name","id","description","format","year","month","ev","stopPropagation","fromNow","Timeline","getInitialState","now","marks","expirations","exp","gotoDate","list","find","parent","vel","offset","top","scrollTop","setState","onShowService","getServiceByUUID","maxHeight","state","overflow","map","e","n","check","plugin","store","cache","Flash","plugin_id","Loading","Model","getState","log","serverboard","service_by_uuid","start_call_stop","then","catch","error","services","s","uuid","handleShowService","serviceid","goto","shortname","handleReload","info","layout","config","extra","width","height","ReactDOM","unmountComponentAtNode","add_widget","main"],"mappings":"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"}