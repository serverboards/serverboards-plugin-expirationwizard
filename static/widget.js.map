{"version":3,"file":null,"sources":["../src/timeline.js","../src/widget.js"],"sourcesContent":["const {React, moment} = Serverboards\nconst {Calendar} = Serverboards.Components\n\nfunction TimelineLine({expiration, service, onClick, hasDivider}){\n  const date = moment(expiration.date)\n  const expired = date.isBefore(moment())\n  let style = {paddingLeft: 5, paddingBottom: \"1rem\"}\n  if (hasDivider){\n    style.borderTop=\"1px solid #eee\"\n    style.paddingTop=\"1rem\"\n  }\n  return (\n    <div className=\"row\"\n      key={`${expiration.service}/${expiration.name}/${expiration.date}/${expiration.id}`}\n      data-tooltip={`${expiration.name}\\n${expiration.description || \"\"}`}\n      style={style}\n      >\n        <div>\n          <a onClick={onClick}><b>{service.name}</b></a> - {date.fromNow()}\n        </div><div className={expired ? \"ui text red\" : \"\"}>\n          {expired ? \"Expired\" : \"Expires\" } on {date.format(\"MMM Do, YY\")}\n        </div>\n    </div>\n  )\n}\n\nconst Timeline = React.createClass({\n  getInitialState(){\n    let marks = {}\n    const now = moment()\n    marks[now.format(\"YYYY-MM-DD\")]=\"bold text teal\"\n\n    for (let exp of this.props.expirations){\n      marks[moment(exp.date).format(\"YYYY-MM-DD\")]=\"background light grey\"\n    }\n\n    return {\n      marks,\n    }\n  },\n  render(){\n    const {expirations, onShowService, getServiceByUUID, maxHeight} = this.props\n    const state = this.state\n    return (\n      <div>\n        <Calendar marks={state.marks} navigation={true}/>\n        <div className=\"ui vertically divided list\" style={{overflow:\"auto\", maxHeight: maxHeight}}>\n          {expirations.map( (e, n) => (\n            <TimelineLine\n              expiration={e}\n              service={getServiceByUUID(e.service)}\n              onClick={() => onShowService(e.service)}\n              hasDivider={n!=0}\n              />\n          ))}\n        </div>\n      </div>\n    )\n  }\n})\n\nexport default Timeline\n","const {plugin, React, store, cache, Flash} = Serverboards\nconst plugin_id=\"serverboards.expiration\"\nimport Timeline from './timeline'\nconst {Loading} = Serverboards.Components\n\nconst Model = React.createClass({\n  getInitialState(){\n    const state = store.getState()\n    console.log(state)\n    return {\n      expirations: undefined,\n      serverboard: state.serverboard.serverboard,\n      service_by_uuid: undefined\n    }\n  },\n  componentDidMount(){\n    plugin.start_call_stop(\"serverboards.expiration/command\", \"list_expirations\", [])\n      .then( (expirations) => this.setState( {expirations} ) )\n    cache.services().then( (services) => {\n      let service_by_uuid={}\n      services.map( (s) => service_by_uuid[s.uuid]=s )\n      this.setState({service_by_uuid})\n    })\n  },\n  handleShowService(serviceid){\n    store.goto(`/serverboard/${this.state.serverboard.shortname}/services/${serviceid}`)\n  },\n  handleReload(){\n    Flash.info(\"This will take long time\")\n    plugin.start_call_stop(\"serverboards.expiration/command\", \"update_expirations\", [])\n      .then( () => { Flash.info(\"Expiration updated\"); this.componentDidMount() } )\n      .catch( (e) => Flash.error(e) )\n  },\n  getServiceByUUID(uuid){\n    return this.state.service_by_uuid[uuid]\n  },\n  render(){\n    if (!this.state.expirations || !this.state.service_by_uuid)\n      return (\n        <Loading>Expirations</Loading>\n      )\n    return (\n      <div className={`ui expirations ${this.props.layout}`}>\n        <Timeline\n          expirations={this.state.expirations}\n          onShowService={this.handleShowService}\n          getServiceByUUID={this.getServiceByUUID}\n          />\n        <button className=\"ui button yellow with icon\" onClick={this.handleReload}>\n          <i className=\"ui refresh icon\"/>\n        </button>\n\n      </div>\n    )\n  }\n})\n\n\nfunction main(el, config, extra){\n  let layout\n  if (extra.layout.width==1 && extra.layout.height==2)\n    layout=\"small\"\n  else if (extra.layout.width > extra.layout.height)\n    layout=\"horizontal\"\n  else\n    layout=\"vertical\"\n\n  Serverboards.ReactDOM.render(<Model {...config} layout={layout}/>, el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_widget(`${plugin_id}/widget`, main)\n"],"names":["Serverboards","React","moment","Calendar","Components","expiration","service","onClick","hasDivider","date","expired","isBefore","style","paddingLeft","paddingBottom","borderTop","paddingTop","name","id","description","fromNow","format","createClass","getInitialState","now","marks","props","expirations","exp","render","onShowService","getServiceByUUID","maxHeight","state","overflow","map","e","n","plugin","store","cache","Flash","plugin_id","Loading","Model","getState","log","serverboard","service_by_uuid","componentDidMount","start_call_stop","then","setState","services","s","uuid","handleShowService","serviceid","goto","shortname","handleReload","info","catch","error","layout","el","config","extra","width","height","ReactDOM","unmountComponentAtNode","add_widget","main"],"mappings":";;;;;;oBAAwBA;AAAjBC,IAAAA,wBAAAA;AAAOC,IAAAA,uBAAAA;AACR,IAAA,CAACC,iBAAD,EAAaH,aAAaI;AAEhC,qBAAA,MAAiE,MAAA,MAA1CC,UAA0C,CAA9BC,CAA8B,MAA9BA,OAA8B,CAArBC,CAAqB,MAArBA,OAAqB,CAAZC,CAAY,MAAZA,UAAY,CACzDC,EAAOP,OAAOG,EAAWI,IAAlB,CADkD,CAEzDC,EAAUD,EAAKE,QAAL,CAAcT,QAAd,CAF+C,CAG3DU,EAAQ,CAACC,YAAa,CAAd,CAAiBC,cAAe,MAAhC,CAHmD,CAQ/D,QAAA,GAHEF,EAAMG,SAAN,CAAgB,gBAGlB,CAFEH,EAAMI,UAAN,CAAiB,MAEnB,EACEf,6BAAK,UAAU,KAAf,CACE,IAAQI,EAAWC,OAAnB,KAA8BD,EAAWY,IAAzC,KAAiDZ,EAAWI,IAA5D,KAAoEJ,EAAWa,EADjF,CAEE,eAAiBb,EAAWY,IAA5B,OAAqCZ,EAAWc,WAAX,EAA0B,EAA/D,CAFF,CAGE,MAAOP,CAHT,EAKIX,iCACEA,2BAAG,QAASM,CAAZ,EAAqBN,+BAAIK,EAAQW,IAAZ,CAArB,CADF,OACoDR,EAAKW,OAAL,EADpD,CALJ,CAOUnB,6BAAK,UAAWS,EAAU,aAAV,CAA0B,EAA1C,EACHA,EAAU,SAAV,CAAsB,SADnB,QACmCD,EAAKY,MAAL,CAAY,YAAZ,CADnC,CAPV,CAYH,CAED,aAAiBpB,QAAMqB,WAAN,CAAkB,wBACjCC,eADiC,2BAChB,CACf,QAAA,CACMC,EAAMtB,QADZ,CAEAuB,EAAMD,EAAIH,MAAJ,CAAW,YAAX,CAAN,EAAgC,gBAHjB,iFAKf,wBAAgB,KAAKK,KAAL,CAAWC,WAA3B,4GAAuC,MAAA,aACrCF,EAAMvB,OAAO0B,EAAInB,IAAX,EAAiBY,MAAjB,CAAwB,YAAxB,CAAN,EAA6C,uBAC9C,CAPc,oLASf,MAAO,CACLI,OADK,CAGR,CAbgC,CAcjCI,MAdiC,kBAczB,YAC4D,KAAKH,KADjE,CACCC,CADD,QACCA,WADD,CACcG,CADd,QACcA,aADd,CAC6BC,CAD7B,QAC6BA,gBAD7B,CAC+CC,CAD/C,QAC+CA,SAD/C,CAEAC,EAAQ,KAAKA,KAFb,CAGN,wCAEIhC,sBAAC,QAAD,EAAU,MAAOgC,EAAMR,KAAvB,CAA8B,aAA9B,EADF,CAEExB,6BAAK,UAAU,4BAAf,CAA4C,MAAO,CAACiC,SAAS,MAAV,CAAkBF,UAAWA,CAA7B,CAAnD,EACGL,EAAYQ,GAAZ,CAAiB,SAACC,CAAD,CAAIC,CAAJ,+BACf,YAAD,EACE,WAAYD,CADd,CAEE,QAASL,EAAiBK,EAAE9B,OAAnB,CAFX,CAGE,QAAS,4BAAoB8B,EAAE9B,OAAhB,CAAN,CAHX,CAIE,WAAe,CAAH,GAJd,EADgB,CAAjB,CADH,CAFF,CAcH,CAhCgC,CAAlB,CAAjB,CAmCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kBC7D6CN;AAAtCsC,IAAAA,qBAAAA;AAAQrC,IAAAA,oBAAAA;AAAOsC,IAAAA,oBAAAA;AAAOC,IAAAA,oBAAAA;AAAOC,IAAAA,oBAAAA;AAC9BC,IAAAA,UAAU;AAChB,YACkB1C,aAAaI,WAAxBuC;AAEDC,IAAAA,MAAQ3C,MAAMqB,WAAN,CAAkB,qBAC9BC,eAD8B,2BACb,CACf,MAAcgB,MAAMM,QAAN,EAAd,CAEA,eADQC,GAAR,CAAYb,CAAZ,CACA,CAAO,CACLN,kBADK,CAELoB,YAAad,EAAMc,WAAN,CAAkBA,WAF1B,CAGLC,sBAHK,CAKR,CAT6B,CAU9BC,iBAV8B,6BAUX,gBACjBX,OAAOY,eAAP,CAAuB,iCAAvB,CAA0D,kBAA1D,KACGC,IADH,CACS,SAACxB,CAAD,eAAsByB,QAAL,CAAe,CAACzB,aAAD,CAAf,CAAjB,CADT,CADiB,CAGjBa,MAAMa,QAAN,GAAiBF,IAAjB,CAAuB,SAACE,CAAD,CAAc,CACnC,QAAA,CACAA,EAASlB,GAAT,CAAc,SAACmB,CAAD,WAAuBA,EAAEC,IAAlB,EAAwBD,CAA/B,CAAd,CAFmC,CAGnC,MAAKF,QAAL,CAAc,CAACJ,iBAAD,CAAd,CACD,CAJD,CAKD,CAlB6B,CAmB9BQ,iBAnB8B,4BAmBZC,CAnBY,CAmBF,CAC1BlB,MAAMmB,IAAN,iBAA2B,KAAKzB,KAAL,CAAWc,WAAX,CAAuBY,SAAlD,cAAwEF,CAAxE,CACD,CArB6B,CAsB9BG,YAtB8B,wBAsBhB,iBACZnB,MAAMoB,IAAN,CAAW,0BAAX,CADY,CAEZvB,OAAOY,eAAP,CAAuB,iCAAvB,CAA0D,oBAA1D,KACGC,IADH,CACS,UAAM,CAAEV,MAAMoB,IAAN,CAAW,oBAAX,CAAF,CAAoC,OAAKZ,iBAAL,EAA0B,CAD7E,EAEGa,KAFH,CAEU,SAAC1B,CAAD,eAAa2B,KAAN,CAAY3B,CAAZ,CAAP,CAFV,CAGD,CA3B6B,CA4B9BL,gBA5B8B,2BA4BbwB,CA5Ba,CA4BR,CACpB,YAAYtB,KAAL,CAAWe,eAAX,CAA2BO,CAA3B,CACR,CA9B6B,CA+B9B1B,MA/B8B,kBA+BtB,aACII,KAAL,CAAWN,WAAZ,EAA4B,KAAKM,KAAL,CAAWe,eADrC,CAMJ,2BAAK,4BAA6B,KAAKtB,KAAL,CAAWsC,MAA7C,EACE,oBAAC,QAAD,EACE,YAAa,KAAK/B,KAAL,CAAWN,WAD1B,CAEE,cAAe,KAAK6B,iBAFtB,CAGE,iBAAkB,KAAKzB,gBAHzB,EADF,CAME,8BAAQ,UAAU,4BAAlB,CAA+C,QAAS,KAAK6B,YAA7D,EACE,yBAAG,UAAU,iBAAb,EADF,CANF,CANI,CAGF,oBAAC,OAAD,oBAeL,CAjD6B,CAAlB;AAqDd,aAAA,CAAcK,CAAd,CAAkBC,CAAlB,CAA0BC,CAA1B,CAAgC,CAC9B,YAAA,CAUA,QAAA,CATwB,CAApB,IAAMH,MAAN,CAAaI,KAAb,EAA8C,CAArB,IAAMJ,MAAN,CAAaK,MAS1C,CARS,OAQT,CAPSF,EAAMH,MAAN,CAAaI,KAAb,CAAqBD,EAAMH,MAAN,CAAaK,MAO3C,CANS,YAMT,CAJS,UAIT,CAFArE,aAAasE,QAAb,CAAsBzC,MAAtB,CAA6B,oBAAC,KAAD,aAAWqC,CAAX,EAAmB,OAAQF,CAA3B,GAA7B,CAAmEC,CAAnE,CAEA,CAAO,UAAU,CACfjE,aAAasE,QAAb,CAAsBC,sBAAtB,CAA6CN,CAA7C,CACD,CACF,CAEDjE,aAAawE,UAAb,CAA2B9B,SAA3B,WAA+C+B,IAA/C;;"}